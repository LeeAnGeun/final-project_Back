<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bit.com.a.dao.onedayClassDao">

<select id="getOnedayClass" parameterType="bit.com.a.dto.onedayClassDto" resultType="bit.com.a.dto.onedayClassDto">
	SELECT CLASSNUM, MASTERNUM, INSTRUCTOR, PRIMARYCATEGORY, SECONDARYCATEGORY, TITLE, CONTENT, STARTDATE, ENDDATE, PRICE, INFORMATION, DURATION, LIMITNUM, PREPARATION,
		ABOUTME, IMAGE1, IMAGE2, IMAGE3, IMAGE4, IMAGE5, LOCATION, YOUTUBELINKE, LIKECOUNT, DEL, OLDREGNUM, NEWREGNUM, A.PROFILEPIC
	FROM ONEDAYCLASS O, ACLAPMEMBER A
	WHERE CLASSNUM = #{classNum}
</select>


<select id="classListData" parameterType="bit.com.a.dto.oneDayClassParam" resultType="bit.com.a.dto.onedayClassDto">

SELECT O.TITLE AS TITLE, O.INSTRUCTOR AS INSTRUCTOR, O.INFORMATION AS INFORMATION, O.DURATION AS DURATION, O.LIMITNUM AS LIMITNUM, O.LIKECOUNT AS LIKECOUNT, 
AVGPOINT, O.STARTDATE AS STARTDATE, O.ENDDATE AS ENDDATE
FROM (SELECT R.CLASSNUM, AVG(STARPOINT) AS AVGPOINT
        FROM REVIEW R, ONEDAYCLASS O
        WHERE R.CLASSNUM = O.CLASSNUM AND O.PRIMARYCATEGORY LIKE '%'||#{primaryCategory}||'%'
        GROUP BY R.CLASSNUM) R, ONEDAYCLASS O

<if test="choice == null or choice == '' and search == null or search == ''">
WHERE R.CLASSNUM = O.CLASSNUM
ORDER BY O.LIKECOUNT DESC
</if>
<if test="choice != null and choice != '' and search != null and search != ''">

<if test="choice == 'orderByLike'">WHERE R.CLASSNUM = O.CLASSNUM AND O.TITLE LIKE '%'||#{search}||'%' ORDER BY O.LIKECOUNT DESC</if>

<if test="choice == 'orderByRecent'">WHERE R.CLASSNUM = O.CLASSNUM AND O.TITLE LIKE '%'||#{search}||'%' ORDER BY O.CLASSNUM DESC</if>

<if test="choice == 'orderByAvg'">WHERE R.CLASSNUM = O.CLASSNUM AND O.TITLE LIKE '%'||#{search}||'%' ORDER BY AVGPOINT DESC </if>
</if>


</select>


</mapper>