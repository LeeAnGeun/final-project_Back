<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="bit.com.a.dao.scheduleDao" >
 
<!-- mypage.html 에서 해당 월에 schedule을 얻어오기 위함 -->
<select resultType="bit.com.a.dto.scheduleDto" parameterType="bit.com.a.dto.scheduleDto" id="getMySchedule">
	SELECT SCHEDULENUM, RDATE, MEMNUM, S.CLASSNUM, S.DEL, O.INSTRUCTOR, O.TITLE, O.INFORMATION
	FROM SCHEDULE S, ONEDAYCLASS O
	WHERE S.CLASSNUM = O.CLASSNUM AND MEMNUM=#{ memNum } AND SUBSTR(RDATE, 1, 7)=#{ rdate } ORDER BY RDATE ASC 
</select>

<!-- mypage.html에서 master에 schedule을 얻어오기 위함 -->
<select id="myclsScheduleData" parameterType="Integer" resultType="bit.com.a.dto.scheduleDto">
	SELECT  S.RDATE as RDATE, S.SCHEDULENUM AS SCHEDULENUM, M.USERNAME AS NAME, S.CLASSNUM AS CLASSNUM, O.TITLE AS TITLE 
	FROM SCHEDULE S, ONEDAYCLASS O, ACLAPMEMBER M
	WHERE S.CLASSNUM = O.CLASSNUM AND #{memNum} = O.MASTERNUM AND M.MEMNUM = S.MEMNUM
</select>

<!-- mypage.html에서 신청한 수업 count -->
<select resultType="Integer" parameterType="bit.com.a.dto.scheduleDto" id="regiCount">
	SELECT COUNT(*)
	FROM SCHEDULE
	WHERE RDATE &gt;= #{ rdate } AND MEMNUM = #{memNum} 
</select>

<!-- mypage.html에서 수강한 수업 count -->
<select resultType="Integer" parameterType="bit.com.a.dto.scheduleDto" id="appendCount">
	SELECT COUNT(*)
	FROM SCHEDULE
	WHERE RDATE &lt; #{ rdate } AND MEMNUM = #{memNum} 
</select>

<!-- classDtail.html에서 classSchedule을 얻기 위함 -->
<select id="classScheduleList" parameterType="bit.com.a.dto.onedayClassDto" resultType="bit.com.a.dto.classScheduleDto">
SELECT YMD AS RDATE, PRICE, DURATION, LIMITNUM
FROM (  SELECT TO_DATE (#{startDate})+(LEVEL) YMD
        FROM DUAL
        CONNECT BY TO_DATE (#{startDate})+(LEVEL) &lt;= TO_DATE (#{endDate}) ) D, ONEDAYCLASS O
WHERE YMD NOT IN (SELECT NOCLASSDATE FROM NOCLASSDATE WHERE CLASSNUM=#{classNum}) AND O.CLASSNUM = #{classNum}
ORDER BY RDATE
</select>

<!-- classDtail.html에서 해당 일에 신청자 수를 얻기 위함  -->
<select id="classSchedulCount" parameterType="bit.com.a.dto.onedayClassDto" resultType="bit.com.a.dto.classSchedulCount">
	SELECT COUNT(*) AS COUNT, RDATE
	FROM SCHEDULE
	WHERE CLASSNUM = #{classNum}
	GROUP BY RDATE
	ORDER BY RDATE
</select>

<select id="noDateList" parameterType="bit.com.a.dto.onedayClassDto" resultType="bit.com.a.dto.classScheduleDto">
	SELECT NOCLASSDATE AS RDATE
	FROM NOCLASSDATE 
	WHERE CLASSNUM = #{classNum}
	ORDER BY RDATE
</select>

</mapper>